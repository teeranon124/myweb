{% extends 'base.html' %}
{% block body %}
<div class="container my-5">
    <!-- ปุ่มสร้างสถานที่ใหม่ -->
    <div class="text-center mb-4">
        <a href="{{ url_for('create_place') }}" class="btn btn-primary">เพิ่มสถานที่ใหม่</a>
    </div>

    <!-- แสดงการ์ดสถานที่ -->
    <div class="row">
        {% for place in places %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <!-- รูปภาพสถานที่ -->
                <img src="{{ place.image }}" class="card-img-top object-fit-cover" 
                     alt="{{ place.name }}" style="height: 200px;">

                <div class="card-body">
                    <!-- ชื่อสถานที่ -->
                    <h5 class="card-title">{{ place.name }}</h5>

                    <!-- คำอธิบายสถานที่ -->
                    <p class="card-text">{{ place.description }}</p>

                    <!-- คะแนนดาว -->
                    <div class="mb-3">
                        <strong>คะแนน:</strong>
                        {% for i in range(1, 6) %}
                            {% if i <= place.average_rating %}
                                <span class="text-warning">★</span>
                            {% else %}
                                <span class="text-secondary">★</span>
                            {% endif %}
                        {% endfor %}
                        ({{ place.average_rating }})
                    </div>

                    <!-- รีวิว -->
                    <div class="mb-3">
                        <a href="{{ url_for('add_review', place_id=place.id) }}">รีวิว</a>
                        <ul class="list-unstyled">
                            {% for review in place.reviews[:3] %}
                            <li class="d-flex align-items-center">
                                <!-- รูปโปรไฟล์ผู้รีวิว -->
                                {% if review.user.profile and review.user.profile.data %}
                                    <img src="{{ url_for('profile_review', user_id=review.user.id) }}" 
                                         class="rounded-circle border border-2 border-light shadow object-fit-cover me-2"
                                         width="30" height="30">
                                {% else %}
                                    <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center text-white me-2"
                                         style="width: 30px; height: 30px;">
                                        <i class="bi bi-person"></i> <!-- ไอคอน -->
                                    </div>
                                {% endif %}

                                <small>
                                    <strong>{{ review.user.username }}:</strong> 
                                    {{ review.content }} ({{ review.rating }} ดาว)
                                </small>
                            </li>
                            {% endfor %}
                        </ul>
                        <!-- ปุ่มดูรีวิวทั้งหมด -->
                        {% if place.reviews|length > 3 %}
                        <a href="{{ url_for('place_detail', place_id=place.id) }}" class="btn btn-sm btn-primary">
                            ดูรีวิวทั้งหมด
                        </a>
                        {% endif %}
                    </div>
                </div>

                <!-- ปุ่มแก้ไขและลบ (สำหรับ admin) -->
                {% if current_user.is_authenticated and current_user.has_role("admin") %}
                <div class="card-footer">
                    <a href="{{ url_for('update_place', place_id=place.id) }}" class="btn btn-sm btn-warning">แก้ไข</a>
                    <a href="{{ url_for('delete_place', place_id=place.id) }}" class="btn btn-sm btn-danger">ลบ</a>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
